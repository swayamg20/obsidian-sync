

async function handleResponse(response) {     console.log("response at handleResponse:", response);     const ttsFunction = voiceBotHelper.getElevenLabsTTSResponsepcm;      const isConfident = (score) => {         const n = typeof score === "number" ? score : parseFloat(score);         return Number.isFinite(n) && n > 0.7;       };     try {         if (response) {             const {                 type,                 data             } = response;             if (type === "info") {                 if (data.message === "conversation_created") {                     console.log("data.data ->", data.data);                     const conversationId = data.data?.conversationId;                     const idToSave = data.data?.id;                     console.log("conversationID:", conversationId);                     const config = {                         type: "save",                         dataToSave: [{                             key: "conversationId",                             source: "conversationId"                         }],                         objectPath: "tara",                     };                     if (idToSave) {                         await aiSdkHelper.saveUserContext(userContextCacheKey, {                             conversationId: idToSave                         }, config, {});                     }                 } else {                     console.log("data.message ->", JSON.stringify(data));                 }                 let cacheData = await redisClient.get(userId + "_TARA_OS_ACTIVE");                 console.log("cacheData ->", cacheData);                 let confidenceScore = data?.data?.confidenceScore;                 console.log("confidenceScore ->", confidenceScore);                  if(isConfident(confidenceScore)==false) {  console.log("confidence score is false");                   await redisClient.set(userId + "_TARA_OS_ACTIVE", false);                 }             } else if (type === "message") {                 const messagePart = data.messageParts[0];                 const responseText = messagePart.text?.content || "";                 const widget = messagePart.widget ? {                     name: messagePart.widget.name,                     parameters: messagePart.widget.parameters,                 } : null;                 console.log("Extracted data:", {                     responseText,                     widget                 });                 const messageToSend = responseText;                 const responseData = {                     responseText: messageToSend,                     widget: widget,                 };                 await aiSdkHelper.sendMessage(responseData, res, ttsFunction);             } else if (type === "input_request") {                 console.log("Input request data:", data);                 if (data.type === "button") {                     let suggestions = data.config.buttonList.map((button) => button.name);                     console.log("suggestions:", suggestions);                     await aiSdkHelper.sendMessage({                         suggestions: suggestions,                         suggestionList: data.config.buttonList,                     }, res, ttsFunction);                 }             }         } else {             await aiSdkHelper.sendMessage("Function call", res, ttsFunction);         }     } catch (error) {         console.error("Error processing response:", error);     } }